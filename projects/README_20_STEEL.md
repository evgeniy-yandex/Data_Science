# Яндекс Практикум. Курс "Data Science". Проект: Предсказание температуры стали на металлургическом комбинате

# Цель проекта.

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Вам предстоит построить модель, которая предскажет температуру стали.

В качестве метрики применять `MAE`. Получить значение MAE для лучшей модели на тестовой выборке не более `6.8`.

## Описание этапа обработки.

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной
температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).


## Описание данных.

Данные состоят из файлов, полученных из разных источников:
* `data_arc_new.csv` — данные об электродах;
* `data_bulk_new.csv` — данные о подаче сыпучих материалов (объём);
* `data_bulk_time_new.csv` — данные о подаче сыпучих материалов (время);
* `data_gas_new.csv` — данные о продувке сплава газом;
* `data_temp_new.csv` — результаты измерения температуры;
* `data_wire_new.csv` — данные о проволочных материалах (объём);
* `data_wire_time_new.csv` — данные о проволочных материалах (время).  

Данные также находятся в тренажёре, в папке `/datasets/`.

Во всех файлах столбец `key` содержит номер партии. В файлах может быть несколько строк с одинаковым значением `key`: они соответствуют разным итерациям обработки.


## План работы.

1. Загрузка и исследование данных.
* Корректная загрузка всех семи датафреймов.
* Поиск аномальных значений.
* Определение пропусков.
* Определение дубликатов.
* Проверка нормальности распределения по гистограммам распределения и графику 'ящик с усами'.


2. Предобработка данных.
* Удаление аномалий.
* Заполнение пропусков.
* Создание новых признаков.
* Агрегирование по ключу.
* Определение дополнительных признаков.
* Определдение целевого признака.

3. Разработка моделей.
* Создание объединённого датафрейма.
* Проверка на мультиколлинеарность.
* Предобработка датафрейма с учётом планируемых к использоанию моделей.
* Проведение масштабирования.
* Разделение на выборки train и test.
* Создание и обучение не менее 3 моделей.
* Подбор гиперпараметров c GridSearchCV.
* Получение метрики MAE на кросс-валидации.
* Выбор лучшей модели.
* Проверка качества лучшей модели на тестовой выборке.
* Исследование важности признаков.

4. Итоговые выводы.


# Отчёт.

**По результатам исследования можно отметить следующие факты и сделать следующие выводы:**

1.Для проведения исследования получены данные с контрольными измерениями по ходу выплавки стали на металлургическом комбинате:
    * мощность электродов с фиксированным временем её измерения,
    * объёме и времени подачи сыпучих легирующих материалов,
    * объёме продуваемого инертного газа,
    * результаты измерения температуры и фиксацией времени измерения,
    * объеме и времени подачи проволочных материалов.

2.Данные подготовлены для дальнейшего анализа:
* названия столбцов приведены к стилю `snake_case`,
* признаки, содержащие информацию о дате и времени приведены к типу datetime.
* удалены аномальные значения,
* проведена проверка и заполнение пропусков,
* выполнена проверка на наличие дубликатов,
* изучены распределения активной и реактивной мощностей,
* установлено, что предоставленные данные охватывают период работы печи по выплавке стали в течении 4 месяцев: от '2019-05-03 11:02:14' по '2019-09-06 17:26:15'.
* отмечено, что в данных о продувке инертных газов отсутствуют нулевые и отрицательные значения.

3.Разработка технологических данных выплавки стали:
* отмечено, что измерения мощности электрода проводились при разных выплавках стали в одном ковше в разных количествах, от 1 до 16.
* Создан новый признак `работа`, рассчитываемый по формуле: 
$$
W = \sqrt{A^2 + R^2} * \delta(t)
$$
где:  
    - A - Активная мощность.  
    - R - Реактивная мощность.  
    - $\delta(t)$ - Интервал времени.
* Данные по объёмам добавляемых материалов имеют 15 признаков с разными легирующими добавками, выгружаемыми в металлугический ковш в зафиксированное время. Значение времени не влияет на температуру расплавленной стали. Важным является сумма всех легирующих добавок оп отдельности, добавленных по ходу плавки в один ковш.
* Исключены выплавки с однократными измерениями температуры.
* Созданы новые признаки:
    * показание первого замера температуры, что соответствует началу выплавки стали,
    * значение последнего измерения температуры, что соответствует окончанию выплавки стали..
    * продолжительность плавки, рассчитываемая как разница между конечным и начальным замерами температуры металлургического ковша при выплавке стали.
* Определен целевой признак для построения модели - значение последнего измерения температуры.
* Данные по объёмам проволочных материалов имеют 9 признаков. Время загрузки в металлугический ковш зафиксировано. Значение времени не влияет на температуру расплавленной стали. Важным является сумма всех проволочных добавок оп отдельности, добавленных по ходу плавки в один ковш.

4.Создадим результирующий объединённый датафрейм.

5.Проведено исследование `мультиколлинеарности` признаков. Установлено  очень высокое значение 0.97 коэффициента Пирсона между признаками `'wire_8'` и `'bulk_9'`. В связи с высокой взаимной зависимостью между `'wire_8'` и `'bulk_9'` (corr = 0.97) удалён признак `'wire_8'`.

6.Датасет разделен на `train` и `test` выборки.

7.Выполнено масштабирование численных признаков обучающей выборки.

8.Согласно заданию на проект, для оценки качества моделей выбрана метрика MAE.

9.Созданы и обучены модели:
* линейные модели:
    * `Линейная регрессия` с механизмом кросс-валидацией.
    * Модель `дерево решений` Decision Tree с подбором глубины дерева.
* ансамблевые модели:
    * Модель `Cлучайного леса` c подбором гиперпараметров GridSearchCV.
    * Модель `GradientBoostingRegressor`  c подбором гиперпараметров GridSearchCV.
* итеративные модели:
    * Модель градиентного бустинга `LightGBM` c подбором гиперпараметров GridSearchCV.
    * Модель градиентного бустинга `CatBoost` c подбором гиперпараметров GridSearchCV.
    * Модель градиентного бустинга `XGBoost` с использованием GridSearch.
    
10.Построен конвейер `pipeline` для создания и оценки 7 моделей:  

    - 'LinearRegression' - линейная модель.
    - 'DecisionTreeRegressor' - линейная модель.
    - 'RandomForestRegressor' - ансамблевая модель.
    - 'GradientBoostingRegressor' - ансамблевая модель.
    - 'LGBMRegressor' - итеративная модель градиентного бустинга.
    - 'CatBoostRegressor' - итеративная модель градиентного бустинга.
    - 'XGBRFRegressor' - итеративная модель градиентного бустинга.
В качестве лучшей в piprline определена модель 'CatBoostRegressor'.    

11.Лучшей моделью является `LGBMRegressor+GridSearchCV` имеющая минимальные MAE = 6.283 и время обучения модели 11 секунд.

12.Проведена проверка лучшей модели на тестовой выборке. Значение MAE на тестовой выборке по лучшей модели: 6.71, что лучше требуемого значения 6.8,
и соответствует требованиям задания на проект.

13.Изучены и определены важные и несущественные признаки для расчёта температуры выплавки стали.

14.Обучена лучшая модель только по важным признакам.
* Значение MAE = 6.32, что чуть хуже, чем на модели с полным количеством призкаков c MAE = 6.28.
* Время обучения модели только с важными признаками сократилось в 2.5 раза, с 13.9 до 5.5 секунд.

15.Проведена успешная проверка адекватности модели на константной выборке.

16.Наиболее важным для оценки температуры стали во время её выплавки является признак `начальная температура`. Чем меньше остынет первичная сталь до начала её легирования, тем меньше будут затраты электроэнергии. 

17.Вторым по важности является признак полная мощность работы электродов за весь цикл выплавки стали. Он прямо влияет на потребление электроэнергии.

18.Судя по тому, что интервалы времени между загрузками добавок неравномерны, металлурги добавляют их, ориентируясь на некие свои показатели. Для экономии электроэнергии можно рекомендовать автоматическую загрузку нужных добавок в зависимости от качественных ориентиров металлугов.

19.Ответы на вопросы руководителя проекта.

19.1. Какие пункты плана были выполнены, а какие нет (поясните, почему)?  

    - Выполнены и перевыполнены все пункты плана. Построены 7 моделей с GridSearchCV в ручном режиме и эти же 7 моделей в конвейере pipeline.
    
19.2. Какие трудности возникли и как вы их преодолели?

    - Были вопросы по техническом вопросам поставленной задачи. Непонятно было, что делать с датафреймами, содержащими информацию по времени загрузки легирующих сыпучих и проволочных добавок. Трудно было принять, что нужно отбросить такую информацию. 
    
19.3. Какие ключевые шаги в решении задачи выделили?

    - 1) Вникнуть в технические вопросы задания.
    - 2) Подготовить данные.
    - 3) Построить модели.
    - 4) Определить лучшую модель и протестировать её.
    - 5) Выделить важные признаки.

19.4. Какая ваши итоговая модель и какое у неё качество?

Лучшей моделью является `LGBMRegressor+GridSearchCV` имеющая минимальные MAE = 6.283 и время обучения модели 11 секунд со следующими значениями гиперараметров:

    - 'learning_rate': 0.02, 
    - 'max_depth': 4, 
    - 'n_estimators': 340,
    - 'random_state' : 300623.
    - Список важных для модели признаков: 'w_total', 'gas_1', 'temp_init', 'melting_time', 'bulk_1', 'bulk_3', 'bulk_4', 'bulk_5', 'bulk_6', 'bulk_10', 'bulk_11', 'bulk_12', 'bulk_14', 'bulk_15', 'wire_1', 'wire_2', 'wire_3', 'wire_6'

19.5. Что рекомендуете для улучшения модели, решения.

    - Для шести из семи (за исключением модели 'дерево решений') значение MAE укладывается в узком диапазоне значений от 6.28 до 6.48. Это говорит о том, что развитие моделей и подбор других гиперпараметров (пробовал) не дают существенного улучшения матрики MAE. Следовательно, надо работать с данными.
    - Добавить фамилию сталевара. Исследовать, есть ли профессионалы с минимальными затратами электроэнергии. Изучить их опыт и передать другим.
    - Отмечать температуру загружаемых добавок и пропускаемого в печь газа.
    - Увеличить выборку данных, по возможности добавить результаты с других подобных предприятий.
    - Построить график вывода температуры от начальной доя рабочей температуры выплавки легированной стали, отслеживать и выяснять причину резких отклонений в обе стороны. Лучше всего - в автоматическом режиме, как указывал выше. Причины потерь электроэнергии - в скачках её потребления.
    - Важно равномерно расставить датчики измерения температуры внутри плавильного ковша. При столь ввысоких температурах вертикальный и горизонтальные градиенты температуры существенны. Важно понимать, что мы получаем на обработку. 

20.Металлургам для контроля расхода электроэнергии в ходе выплавки стали   можно рекомендовать использовать модель `LGBMRegressor`.


[Вернутся к общему списку](../README.md)